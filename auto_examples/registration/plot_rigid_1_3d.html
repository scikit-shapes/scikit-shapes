

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rigid alignment in 3D with landmarks &mdash; Scikit-Shapes 0.3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=56c72f64" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=4621528c"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Registration with LDDMM" href="plot_lddmm_0_skulls.html" />
    <link rel="prev" title="Rigid alignment in 2D" href="plot_rigid_0_2d.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Scikit-Shapes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../motivation.html">Why Scikit-Shapes?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">User guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Gallery of examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#loading-and-manipulating-data">Loading and manipulating data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#working-at-multiple-scales">Working at multiple scales</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#computing-shape-features">Computing shape features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#registering-and-aligning-shapes-with-each-other">Registering and aligning shapes with each other</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#using-one-of-our-interactive-applications">Using one of our interactive applications</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#defining-a-custom-model-or-loss-function">Defining a custom model or loss function</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../data/index.html">Loading and manipulating data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multiscaling/index.html">Working at multiple scales</a></li>
<li class="toctree-l3"><a class="reference internal" href="../features/index.html">Computing shape features</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Registering and aligning shapes with each other</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="plot_karateka.html">Intrinsic vs Extrinsic deformation</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_rigid_0_2d.html">Rigid alignment in 2D</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Rigid alignment in 3D with landmarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_lddmm_0_skulls.html">Registration with LDDMM</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_lddmm_1_normalization.html">LDDMM with normalized kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="plot_multiscale_elastic.html">Elastic metric and multiscale strategy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../applications/index.html">Using one of our interactive applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../customization/index.html">Defining a custom model or loss function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../stubs/skshapes.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../explanation/index.html">How Scikit-Shapes works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Scikit-Shapes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Gallery of examples</a></li>
          <li class="breadcrumb-item"><a href="index.html">Registering and aligning shapes with each other</a></li>
      <li class="breadcrumb-item active">Rigid alignment in 3D with landmarks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/auto_examples/registration/plot_rigid_1_3d.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-registration-plot-rigid-1-3d-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="rigid-alignment-in-3d-with-landmarks">
<span id="sphx-glr-auto-examples-registration-plot-rigid-1-3d-py"></span><h1>Rigid alignment in 3D with landmarks<a class="headerlink" href="#rigid-alignment-in-3d-with-landmarks" title="Link to this heading"></a></h1>
<p>In this example, we demonstrate how to perform rigid registration (also known
alignment) of two 3D meshes. We also show how to improve the registration by
adding landmarks.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pykeops</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="kn">import</span> <span class="n">examples</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pykeops</span><span class="o">.</span><span class="n">get_build_folder</span><span class="p">())</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">skshapes</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sks</span>

<span class="n">color_1</span> <span class="o">=</span> <span class="s2">&quot;tan&quot;</span>
<span class="n">color_2</span> <span class="o">=</span> <span class="s2">&quot;brown&quot;</span>
</pre></div>
</div>
<section id="load-data">
<h2>Load data<a class="headerlink" href="#load-data" title="Link to this heading"></a></h2>
<p>We load two meshes from the <cite>pyvista</cite> example datasets. We then rescale them
to lie in the unit cube to avoid dealing with scale issues.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># shape1 = sks.PolyData(examples.download_human())</span>
<span class="n">shape1</span> <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">examples</span><span class="o">.</span><span class="n">download_woman</span><span class="p">()</span><span class="o">.</span><span class="n">rotate_y</span><span class="p">(</span><span class="mi">90</span><span class="p">))</span>
<span class="n">shape2</span> <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">examples</span><span class="o">.</span><span class="n">download_doorman</span><span class="p">())</span>
<span class="n">shape1</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">shape2</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">bounds</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="p">)</span>


<span class="n">lims1</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">(</span><span class="n">shape1</span><span class="p">)</span>
<span class="n">lims2</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">(</span><span class="n">shape2</span><span class="p">)</span>
<span class="n">rescale1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lims1</span><span class="p">)</span>
<span class="n">shape1</span><span class="o">.</span><span class="n">points</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shape1</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">shape1</span><span class="o">.</span><span class="n">points</span> <span class="o">/=</span> <span class="n">rescale1</span>

<span class="n">rescale2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lims2</span><span class="p">)</span>
<span class="n">shape2</span><span class="o">.</span><span class="n">points</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">shape2</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">shape2</span><span class="o">.</span><span class="n">points</span> <span class="o">/=</span> <span class="n">rescale2</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/jaxtyping/_decorator.py:562: UserWarning: Mesh has been cleaned and points were removed. point_data is ignored.
  return wrapped_fn_impl(args, kwargs, bound, memos)
</pre></div>
</div>
</section>
<section id="plot-the-data">
<h2>Plot the data<a class="headerlink" href="#plot-the-data" title="Link to this heading"></a></h2>
<p>Let us have a look at the two shapes we want to align. Clearly, they are not
aligned and a rigid transformation is needed.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">shape1</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_1</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">shape2</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_2</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-0">
Static Scene</label><div class="sd-tab-content docutils">
<img src="../../_images/sphx_glr_plot_rigid_1_3d_001.png" srcset="../../_images/sphx_glr_plot_rigid_1_3d_001.png" alt="plot rigid 1 3d" class = "sphx-glr-single-img"/></div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-1">
Interactive Scene</label><div class="sd-tab-content docutils">

    <iframe src='../../_static/static_viewer.html?fileURL=../_images/auto_examples/registration/images/sphx_glr_plot_rigid_1_3d_001.vtksz' width='100%%' height='400px' frameborder='0'></iframe>
</div>
</div>
</section>
<section id="apply-the-registration">
<h2>Apply the registration<a class="headerlink" href="#apply-the-registration" title="Link to this heading"></a></h2>
<p>We now apply the registration. The meshes points are not in correspondence
and we need to use a loss function that can handle this. We use the nearest
neighbors loss.
Using this loss leads to converge to a local minimum, where the shapesa are
aligned upside down.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">loss</span> <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">NearestNeighborsLoss</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">RigidMotion</span><span class="p">()</span>

<span class="n">registration</span> <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">Registration</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
    <span class="n">n_iter</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># default optimizer is torch.optim.LBFGS</span>

<span class="n">registration</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">shape2</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">shape1</span><span class="p">)</span>
<span class="n">morph</span> <span class="o">=</span> <span class="n">registration</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">shape2</span><span class="p">)</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">shape1</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_1</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">morph</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_2</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" for="sd-tab-item-2">
Static Scene</label><div class="sd-tab-content docutils">
<img src="../../_images/sphx_glr_plot_rigid_1_3d_002.png" srcset="../../_images/sphx_glr_plot_rigid_1_3d_002.png" alt="plot rigid 1 3d" class = "sphx-glr-single-img"/></div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" for="sd-tab-item-3">
Interactive Scene</label><div class="sd-tab-content docutils">

    <iframe src='../../_static/static_viewer.html?fileURL=../_images/auto_examples/registration/images/sphx_glr_plot_rigid_1_3d_002.vtksz' width='100%%' height='400px' frameborder='0'></iframe>
</div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Initial loss : 4.28e-01
  = 4.28e-01 + 1 * 0.00e+00 (fidelity + regularization_weight * regularization)
Loss after 1 iteration(s) : 1.45e-01
  = 1.45e-01 + 1 * 0.00e+00 (fidelity + regularization_weight * regularization)
Loss after 2 iteration(s) : 4.74e-02
  = 4.74e-02 + 1 * 0.00e+00 (fidelity + regularization_weight * regularization)
</pre></div>
</div>
</section>
<section id="add-landmarks">
<h2>Add landmarks<a class="headerlink" href="#add-landmarks" title="Link to this heading"></a></h2>
<p>We now add landmarks to the two shapes. Three landmarks (head, left hand,
right hand) are enough to greatly improve the registration. If you are running this script locally,
you can use the landmark setter application to select the landmarks interactively.
If you are seeing this in the gallery, here is a recording of the landmark setter
application being used to select the landmarks:</p>
<img alt="../../_images/demolandmarks.gif" src="../../_images/demolandmarks.gif" />
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">pv</span><span class="o">.</span><span class="n">BUILDING_GALLERY</span><span class="p">:</span>
    <span class="c1"># If not in the gallery, we can use vedo to open the landmark setter</span>
    <span class="c1"># Setting the default backend to vtk is necessary when running in a notebook</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">vedo</span>

    <span class="n">vedo</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">default_backend</span> <span class="o">=</span> <span class="s2">&quot;vtk&quot;</span>
    <span class="n">sks</span><span class="o">.</span><span class="n">LandmarkSetter</span><span class="p">([</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">])</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Set the landmarks manually</span>
    <span class="n">landmarks1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4808</span><span class="p">,</span> <span class="mi">147742</span><span class="p">,</span> <span class="mi">1774</span><span class="p">]</span>
    <span class="n">landmarks2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">325</span><span class="p">,</span> <span class="mi">2116</span><span class="p">,</span> <span class="mi">1927</span><span class="p">]</span>

    <span class="n">shape1</span><span class="o">.</span><span class="n">landmark_indices</span> <span class="o">=</span> <span class="n">landmarks1</span>
    <span class="n">shape2</span><span class="o">.</span><span class="n">landmark_indices</span> <span class="o">=</span> <span class="n">landmarks2</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">]</span>
<span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">shape1</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape1</span><span class="o">.</span><span class="n">landmark_indices</span><span class="p">)):</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span>
        <span class="n">shape1</span><span class="o">.</span><span class="n">landmark_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">render_points_as_spheres</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">point_size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">shape2</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape2</span><span class="o">.</span><span class="n">landmark_indices</span><span class="p">)):</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">add_points</span><span class="p">(</span>
        <span class="n">shape2</span><span class="o">.</span><span class="n">landmark_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">render_points_as_spheres</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">point_size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" for="sd-tab-item-4">
Static Scene</label><div class="sd-tab-content docutils">
<img src="../../_images/sphx_glr_plot_rigid_1_3d_003.png" srcset="../../_images/sphx_glr_plot_rigid_1_3d_003.png" alt="plot rigid 1 3d" class = "sphx-glr-single-img"/></div>
<input id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" for="sd-tab-item-5">
Interactive Scene</label><div class="sd-tab-content docutils">

    <iframe src='../../_static/static_viewer.html?fileURL=../_images/auto_examples/registration/images/sphx_glr_plot_rigid_1_3d_003.vtksz' width='100%%' height='400px' frameborder='0'></iframe>
</div>
</div>
</section>
<section id="register-again-with-a-loss-that-includes-landmarks">
<h2>Register again with a loss that includes landmarks<a class="headerlink" href="#register-again-with-a-loss-that-includes-landmarks" title="Link to this heading"></a></h2>
<p>Now the loss is the sum of <cite>NearestNeighborsLoss</cite> and <cite>LandmarkLoss</cite>, the
mean L2 distance between the landmarks in the two shapes.
The registration now converges to a better solution.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">loss_landmarks</span> <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">NearestNeighborsLoss</span><span class="p">()</span> <span class="o">+</span> <span class="n">sks</span><span class="o">.</span><span class="n">LandmarkLoss</span><span class="p">()</span>

<span class="n">registration</span> <span class="o">=</span> <span class="n">sks</span><span class="o">.</span><span class="n">Registration</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">loss_landmarks</span><span class="p">,</span>
    <span class="n">n_iter</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">registration</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">shape2</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">shape1</span><span class="p">)</span>
<span class="n">morph</span> <span class="o">=</span> <span class="n">registration</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">shape2</span><span class="p">)</span>

<span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">shape1</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_1</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">morph</span><span class="o">.</span><span class="n">to_pyvista</span><span class="p">(),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_2</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" for="sd-tab-item-6">
Static Scene</label><div class="sd-tab-content docutils">
<img src="../../_images/sphx_glr_plot_rigid_1_3d_004.png" srcset="../../_images/sphx_glr_plot_rigid_1_3d_004.png" alt="plot rigid 1 3d" class = "sphx-glr-single-img"/></div>
<input id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" for="sd-tab-item-7">
Interactive Scene</label><div class="sd-tab-content docutils">

    <iframe src='../../_static/static_viewer.html?fileURL=../_images/auto_examples/registration/images/sphx_glr_plot_rigid_1_3d_004.vtksz' width='100%%' height='400px' frameborder='0'></iframe>
</div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Initial loss : 1.58e+00
  = 1.58e+00 + 1 * 0.00e+00 (fidelity + regularization_weight * regularization)
Loss after 1 iteration(s) : 7.36e-02
  = 7.36e-02 + 1 * 0.00e+00 (fidelity + regularization_weight * regularization)
Loss after 2 iteration(s) : 7.13e-02
  = 7.13e-02 + 1 * 0.00e+00 (fidelity + regularization_weight * regularization)
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (1 minutes 2.176 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-registration-plot-rigid-1-3d-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/2ce64ac417adc5dd6a93d8820f04959d/plot_rigid_1_3d.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_rigid_1_3d.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/38f9345ac5990f1a0c2706349a51eff1/plot_rigid_1_3d.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_rigid_1_3d.py</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plot_rigid_0_2d.html" class="btn btn-neutral float-left" title="Rigid alignment in 2D" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plot_lddmm_0_skulls.html" class="btn btn-neutral float-right" title="Registration with LDDMM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2025, The Scikit-Shapes team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>